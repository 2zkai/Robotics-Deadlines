<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robotics-Deadlines</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>
            <div>机器人投稿倒计时</div>
            <div>Robotics Deadlines</div>
        </h1>
        <div id="conferences" class="conferences-list"></div>
    </div>

    <script>
        let conferences = [];

        // 会议分类定义
        const categories = {
            'strongly-robotics': {
                chinese: '机器人强相关',
                english: 'Strongly Related to Robotics'
            },
            'moderately-robotics': {
                chinese: '机器人中等相关',
                english: 'Moderately Related to Robotics'
            },
            'strongly-ai': {
                chinese: 'AI强相关',
                english: 'Strongly Related to AI'
            }
        };

        // 获取已存储的会议数据
        function loadConferences() {
            fetch('/api/conferences')
                .then(response => response.json())
                .then(data => {
                    conferences = data;
                    displayConferences();
                });
        }

        // 显示已添加的会议和倒计时
        function displayConferences() {
            const conferencesDiv = document.getElementById("conferences");
            conferencesDiv.innerHTML = "";

            // 为每个分类创建一个部分
            Object.entries(categories).forEach(([categoryId, category]) => {
                const categoryDiv = document.createElement("div");
                categoryDiv.classList.add("category-section");
                categoryDiv.innerHTML = `
                    <h2>
                        ${category.chinese}
                        <span class="english-title">${category.english}</span>
                    </h2>
                `;
                
                // 获取该分类下的所有会议
                const categoryConferences = conferences.filter(conf => {
                    // 根据分类ID映射到原始分类
                    const categoryMapping = {
                        'strongly-robotics': ['systems', 'planning', 'human-interaction', 'applications'],
                        'moderately-robotics': ['perception', 'computer-vision', 'control'],
                        'strongly-ai': ['learning']
                    };
                    return categoryMapping[categoryId].includes(conf.category);
                });
                
                if (categoryConferences.length > 0) {
                    categoryConferences.forEach((conference) => {
                        const conferenceDiv = document.createElement("div");
                        conferenceDiv.classList.add("conference-item");

                        conferenceDiv.innerHTML = `
                            <div class="conference-name">${conference.name}</div>
                            <div class="conference-details">
                                <div class="deadline">${conference.deadline}</div>
                                <div id="countdown-${conference.name}" class="countdown"></div>
                            </div>
                        `;
                        categoryDiv.appendChild(conferenceDiv);
                        startCountdown(conference);
                    });
                } else {
                    categoryDiv.innerHTML += '<p class="no-conferences">暂无会议</p>';
                }
                
                conferencesDiv.appendChild(categoryDiv);
            });
        }

        // 启动倒计时
        function startCountdown(conference) {
            const countdownElement = document.getElementById(`countdown-${conference.name}`);

            setInterval(function() {
                const now = new Date().getTime();
                const distance = new Date(conference.deadline).getTime() - now;

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                countdownElement.innerHTML = `${days}天 ${hours}小时 ${minutes}分钟 ${seconds}秒`;

                if (distance < 0) {
                    countdownElement.innerHTML = "投稿截止!";
                }
            }, 1000);
        }

        loadConferences();
    </script>
</body>
</html>